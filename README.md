# LifeDashboard Android Connector

## 概要

LifeDashboard Android Connector は、スマートフォンの使用状況データを収集し、LifeDashboard サービスに送信するアプリケーションです。常時バックグラウンドで動作し、5分ごとにデータを収集・送信することで、使用状況の詳細な分析が可能になります。

## 主な機能

- **使用状況データの自動収集**: アプリの使用時間、起動回数などを5分ごとに自動収集
- **バックグラウンド同期**: 収集したデータをLifeDashboardサーバーに定期送信
- **使用統計の可視化**: 時間帯別の使用パターンをグラフで表示
- **同期状況の管理**: 過去の同期履歴を確認可能
- **バッテリー最適化**: 長時間のバックグラウンド実行に最適化

## 技術仕様

- **対応 Android バージョン**: Android 8.0（API 26）以上
- **言語**: Kotlin
- **アーキテクチャ**: MVVM
- **使用ライブラリ**:
  - AndroidX Core, AppCompat, ConstraintLayout
  - WorkManager: バックグラウンドタスク管理
  - MPAndroidChart: グラフ描画
  - Room: ローカルデータベース
  - Coroutines: 非同期処理

## 必要な権限

アプリが正常に動作するためには以下の権限が必要です：

- `PACKAGE_USAGE_STATS`: アプリの使用統計にアクセスするために必要
- `FOREGROUND_SERVICE`: バックグラウンドで安定して実行するために必要
- `FOREGROUND_SERVICE_DATA_SYNC`: データ同期のためのフォアグラウンドサービス権限
- `INTERNET`: サーバーへのデータ送信に必要
- `RECEIVE_BOOT_COMPLETED`: 端末再起動後の自動起動に必要
- `WAKE_LOCK`: バックグラウンド処理の安定性向上のため
- `REQUEST_IGNORE_BATTERY_OPTIMIZATIONS`: バッテリー最適化からの除外を要求

## セットアップと使用方法

1. アプリをインストールし起動します
2. 初回起動時に使用状況へのアクセス許可を求められるので許可してください
3. 設定画面でLifeDashboardアカウント情報を入力します
4. アプリは自動的にバックグラウンドで動作を開始し、5分ごとにデータを送信します
5. メイン画面では同期状況と使用状況サマリーを確認できます

## バッテリー最適化の除外

安定した動作のため、バッテリー最適化から除外することを推奨しています：

1. アプリ初回起動時に表示されるダイアログで「設定を開く」をタップ
2. 表示される設定画面で「最適化しない」を選択

## データ収集の仕組み

1. `UsageStatsManager`を使用して端末の使用状況データにアクセス
2. アプリごとの使用時間や起動回数を5分ごとに収集
3. 時間帯ごとにデータを整理し、サーバーに送信
4. 同期結果と収集データはローカルに保存され、UIで確認可能

## トラブルシューティング

- **データが収集されない場合**: 「設定 > プライバシー > 使用状況へのアクセス」で権限が許可されているか確認
- **バックグラウンドでアプリが停止する**: バッテリー最適化の除外設定を確認
- **同期エラーが続く**: サーバーアドレスとアカウント情報を確認

## プライバシーポリシー

このアプリは個人の使用状況データを収集しますが、収集されるデータは以下のみです：

- アプリの使用時間と起動回数
- 画面ロック解除回数
- 通知数
- バッテリーレベル

収集されたデータはLifeDashboardサービスでのみ使用され、第三者に共有されることはありません。詳細なプライバシーポリシーはLifeDashboardサービスのものに準拠します。

## 開発者向け情報

### ビルド方法

```bash
# リポジトリをクローン
git clone https://github.com/yourusername/life-dashboard-connector.git

# プロジェクトディレクトリに移動
cd life-dashboard-connector

# Gradleでビルド
./gradlew build
```

### コードの主要部分

- `MainActivity`: アプリのメインUI
- `PhoneUsageRepository`: 使用状況データの収集と管理
- `UsageDataUploadService`: 5分ごとの定期的なデータ収集と送信を担当
- `LifeDashboardAPI`: サーバーとの通信処理
- `DatabaseHelper`: 同期履歴の保存と管理

### カスタマイズ

サーバーアドレスなどのカスタマイズは `SettingsActivity` から行えます。開発者向けのカスタマイズは以下のファイルで設定可能です：

- サーバーURLのデフォルト値: `LifeDashboardAPI.kt`
- 同期間隔の変更: `MainActivity.kt` の `setupPeriodicWorker()` メソッド

